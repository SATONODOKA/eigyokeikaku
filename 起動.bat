@echo off
chcp 65001 >nul
title å–¶æ¥­è¨ˆç”»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

echo.
echo ========================================
echo   å–¶æ¥­è¨ˆç”»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
echo ========================================
echo.

REM ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
set CURRENT_DIR=%~dp0
set NODE_DIR=%CURRENT_DIR%nodejs-portable
set NODE_EXE=%NODE_DIR%\node.exe
set NPM_CMD=%NODE_DIR%\npm.cmd

REM PATHã‚’è¨­å®š
set PATH=%NODE_DIR%;%PATH%

REM ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¯¾å¿œï¼ˆè¨¼æ˜æ›¸ã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
set NODE_TLS_REJECT_UNAUTHORIZED=0

REM node_modulesãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
if not exist "node_modules\" (
    echo.
    echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    echo â•‘                    ğŸ”§ åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—                       â•‘
    echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    echo.
    echo ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™...
    echo ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãŒå¿…è¦ã§ã™ã€‚é€šå¸¸3ã€œ5åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚
    echo.
    echo â€» ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã«å¯¾å¿œã—ã¦ã„ã¾ã™ï¼ˆè¨¼æ˜æ›¸æ¤œè¨¼ã‚’ç„¡åŠ¹åŒ–ï¼‰
    echo.
    echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    echo   â€» é€²æ—ã¯ä¸‹è¨˜ã«è¡¨ç¤ºã•ã‚Œã¾ã™ â€»
    echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    echo.
    call "%NPM_CMD%" install --progress=true --loglevel=info
    if %errorlevel% neq 0 (
        echo.
        echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        echo â•‘                    âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ                   â•‘
        echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        echo.
        echo ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸã€‚
        echo ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
        echo   1. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š
        echo   2. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š
        echo   3. ã‚¦ã‚¤ãƒ«ã‚¹å¯¾ç­–ã‚½ãƒ•ãƒˆã®è¨­å®š
        echo.
        pause
        exit /b 1
    )
    echo.
    echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    echo.
    echo âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼
    echo.
)

echo ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ä¸­...
echo.
echo ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•ã§é–‹ã‹ãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®URLã‚’é–‹ã„ã¦ãã ã•ã„ï¼š
echo http://localhost:3000
echo.
echo ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã™ã‚‹ã«ã¯ã€ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚
echo ========================================
echo.

REM ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã
timeout /t 3 /nobreak >nul
start http://localhost:3000

REM ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
call "%NPM_CMD%" run dev
